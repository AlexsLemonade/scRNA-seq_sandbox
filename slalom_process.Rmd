---
title: "Slalom Data Processing"
author: "C. Savonen, CCDL for ALSF"
date: "12/10/2018"
output: html_document
---
```{r Install Packages}
# Install Slalom if its not 
if (!("slalom" %in% installed.packages())) {
  source("https://bioconductor.org/biocLite.R")
  biocLite("slalom", suppressUpdates = FALSE)
}
# Attach the library
library("slalom")
library("org.Hs.eg.db")
```

```{r Import Data}
tx.counts <- readRDS(file.path("patel_data", "patel.counts.data.tsv"))

# Change rownames to gene symbols instead of ensembl gene IDs
rownames(tx.counts) <- mapIds(org.Hs.eg.db, keys = rownames(tx.counts),
                                         column = "SYMBOL", keytype = "ENSEMBL")
```

```{r Format Data}
exprs_matrix <- SingleCellExperiment::logcounts(tx.counts)
tx.counts <- SingleCellExperiment::SingleCellExperiment(
    assays = list(logcounts = exprs_matrix)
)
gmtfile <- system.file("extdata", "reactome_subset.gmt", package = "slalom")
genesets <- GSEABase::getGmt(gmtfile)

model <- newSlalomModel(tx.counts, genesets, n_hidden = 5, min_genes = 10)

model <- initSlalom(model)

model <- trainSlalom(model, nIterations = 10)
```

```{r Save Data}

```